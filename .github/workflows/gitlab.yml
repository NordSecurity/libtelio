name: GitLab CI Pipeline
on:
  pull_request_target:
    branches: [main]
  push:
    branches: [main]
permissions: {}

jobs:
  trigger-gitlab-pipeline:
    runs-on: [self-hosted, libtelio]
    if: |
      github.event_name == 'push' ||
      (
        github.event_name == 'pull_request_target' &&
        (
          contains(github.event.pull_request.labels.*.name, 'run tests') ||
          (github.event.pull_request.head.repo.full_name == github.event.pull_request.base.repo.full_name)
        )
      )
    steps:
      - uses: NordSecurity/trigger-gitlab-pipeline@fd24fd4a3d03065fe67ae1e98d05d4283d7bb104 # v1
        with:
          ci-api-v4-url: ${{ secrets.CI_API_V4_URL }}
          project-id: ${{ secrets.PROJECT_ID }}
          token: ${{ secrets.TOKEN }}
          ref: v0.1.2
